(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{195:function(e,t,n){e.exports=n.p+"static/media/profile_img.0cc8b8fb.jpg"},237:function(e,t,n){e.exports=n(469)},242:function(e,t,n){},245:function(e,t,n){},250:function(e,t,n){},251:function(e,t,n){},253:function(e,t,n){},427:function(e,t,n){},469:function(e,t,n){"use strict";n.r(t);var a,r=n(1),c=n.n(r),i=n(20),o=n.n(i),u=(n(242),n(8)),l=n.n(u),s=n(12),m=(n(245),n(15)),p=n(25),d=(n(250),n(251),n(472)),f=n(478),v=n(479),E=n(194),h=n.n(E),g=n(195),y=n.n(g),b=Object(m.b)(function(e){return{user:e.user,activitiesCount:e.activities.activityList.length,latestActivity:(t=e.activities.activityList,t.sort(function(e,t){return new Date(t.start_date_local).getTime()-new Date(e.start_date_local).getTime()})[0])};var t})(function(e){return c.a.createElement("div",{className:"profile"},c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(d.a,{src:y.a,style:{marginBottom:"-2.5rem",zIndex:1e5,position:"relative",maxWidth:"80px",maxHeight:"80px"},roundedCircle:!0})),c.a.createElement(f.a,null,c.a.createElement(f.a.Header,null,c.a.createElement("div",{className:"profileBody text-center"},c.a.createElement("h3",null,e.user.username),c.a.createElement("p",null,"Activities - ",e.activitiesCount))),c.a.createElement(v.a,{variant:"flush"},c.a.createElement(v.a.Item,null,c.a.createElement(function(){return e.latestActivity?c.a.createElement("div",null,"Latest activity:",c.a.createElement("br",null),c.a.createElement("b",null,e.latestActivity.type),"\xa0- ",c.a.createElement(h.a,{format:"MMM DD, YYYY"},e.latestActivity.start_date_local)):c.a.createElement("div",null)},null)),c.a.createElement(v.a.Item,null,"Your Training Log"))))}),w=(n(253),n(61)),k=function(e,t){var n=new Date(e);n.setHours(0,0,0,0);var a=new Date(t);return a.setHours(0,0,0,0),n.getTime()-a.getTime()},S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],O=new Date(Date.now()-5184e5),x=function(e){for(var t=new Date(O),n=[],a=0;a<7;a++){var r=e.filter(function(e){return 0===k(new Date(e.start_date_local),t)}).map(function(e){return e.distance}).reduce(function(e,t){return e+t},0);n[a]={day:S[t.getDay()],distance:r=Math.round(10*r/1e3)/10},t.setDate(t.getDate()+1)}return n},j=Object(m.b)(function(e){return{activities:(t=e.activities.activityList,n=e.activitiesSummary.selectedActivity,t.filter(function(e){return e.type===n&&k(new Date(e.start_date_local),O)>=0}))};var t,n})(function(e){return c.a.createElement("div",null,c.a.createElement(w.b,{width:500,height:150,data:x(e.activities),margin:{top:5,right:30,left:0,bottom:5}},c.a.createElement(w.d,{dataKey:"day"}),c.a.createElement(w.e,null),c.a.createElement(w.c,null),c.a.createElement(w.a,{dataKey:"distance",fill:"#8884d8"})),c.a.createElement("p",{className:"text-muted"},"Strava"))}),I=(n(427),n(473)),T=n(205),_=n(96),C=n.n(_),A=n(18);!function(e){e.AlpineSki="AlpineSki",e.BackcountrySki="BackcountrySki",e.Canoeing="Canoeing",e.Crossfit="Crossfit",e.EBikeRide="EBikeRide",e.Elliptical="Elliptical",e.Golf="Golf",e.Handcycle="Handcycle",e.Hike="Hike",e.IceSkate="IceSkate",e.InlineSkate="InlineSkate",e.Kayaking="Kayaking",e.Kitesurf="Kitesurf",e.NordicSki="NordicSki",e.Ride="Ride",e.RockClimbing="RockClimbing",e.RollerSki="RollerSki",e.Rowing="Rowing",e.Run="Run",e.Sail="Sail",e.Skateboard="Skateboard",e.Snowboard="Snowboard",e.Snowshoe="Snowshoe",e.Soccer="Soccer",e.StairStepper="StairStepper",e.StandUpPaddling="StandUpPaddling",e.Surfing="Surfing",e.Swim="Swim",e.Velomobile="Velomobile",e.VirtualRide="VirtualRide",e.VirtualRun="VirtualRun",e.Walk="Walk",e.WeightTraining="WeightTraining",e.Wheelchair="Wheelchair",e.Windsurf="Windsurf",e.Workout="Workout",e.Yoga="Yoga"}(a||(a={}));var L,R,D=A.a(function(){for(var e={},t=0;t<37;t++)e.Ride=14;return e}()),N=n(57),U={selectedActivity:a.Ride},G={setActivity:function(e){return function(t){t({type:"SET_ACTIVITY",data:e})}}},z=Object(m.b)(function(e){return{selectedActivity:e.activitiesSummary.selectedActivity}},G)(function(e){var t={color:"white",textShadow:"0 1px 0 rgba(0, 0, 0, 0.1)"},n=function(t){return function(){e.setActivity(t)}};return c.a.createElement("div",null,c.a.createElement(I.a,null,c.a.createElement(T.a,{variant:"secondary",onClick:n(a.Ride),active:e.selectedActivity===a.Ride},c.a.createElement(C.a,{className:"activityIcon",name:"bicycle",size:"2x",style:t})),c.a.createElement(T.a,{variant:"secondary",onClick:n(a.Run),active:e.selectedActivity===a.Run},c.a.createElement(C.a,{name:"running",size:"2x",style:t})),c.a.createElement(T.a,{variant:"secondary",onClick:n(a.Swim),active:e.selectedActivity===a.Swim},c.a.createElement(C.a,{name:"swimmer",size:"2x",style:t}))))}),H=Object(m.b)(function(e){return{activities:e.activities}})(function(e){return c.a.createElement("div",null,c.a.createElement(f.a,null,c.a.createElement(f.a.Header,null,"Activities Summary"),c.a.createElement(v.a,{variant:"flush"},c.a.createElement(v.a.Item,null,c.a.createElement(z,null)),c.a.createElement(v.a.Item,null,c.a.createElement(j,null)),c.a.createElement(v.a.Item,null,"Month summary"))))}),W=function(){return c.a.createElement("div",null,c.a.createElement(b,null),c.a.createElement(H,null))},K=n(27),B=n.n(K),F=A.d({id:A.b,name:A.c,distance:A.b,moving_time:A.b,elapsed_time:A.b,type:D,start_date_local:A.c,workout_type:A.b,average_speed:A.b,max_speed:A.b,kilojoules:A.b,description:A.c,calories:A.b}),V={getRedirectUrl:function(){var e=Object(s.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat("/api/stravaauth","/redirectUrl"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),refreshToken:function(){var e=Object(s.a)(l.a.mark(function e(t){var n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat("/api/stravaauth","/refreshToken"),{userId:t});case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},Y=B.a.create(),q=function(){var e=Object(s.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.get("https://www.strava.com/api/v3/athlete/activities");case 2:return t=e.sent,n=t.data,M(n),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),M=function(e){e.forEach(function(e){return F.decode(e)})},P={getAll:q,setInterceptor:function(e){var t;R&&Y.interceptors.request.eject(R),e.stravaToken,R=Y.interceptors.request.use((t=e,function(){var e=Object(s.a)(l.a.mark(function e(n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((L=t).stravaToken.expiresAt-(new Date).getTime()/1e3<0)){e.next=6;break}return e.next=5,V.refreshToken(L.id);case 5:L.stravaToken=e.sent;case 6:return n.headers=Object(N.a)({},n.headers,{Authorization:"Bearer ".concat(L.stravaToken.accessToken)}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()))},ejectInterceptor:function(){console.log("Ejecting interceptor"),Y.interceptors.request.eject(R)}},J={initialized:!1,activityList:[]},Z={post:function(){var e=Object(s.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("/api/users",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},Q=function(){var e=Object(s.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B.a.post("".concat("/api/login"),t);case 3:return n=e.sent,console.log("Service logged in user"),e.abrupt("return",n);case 8:throw e.prev=8,e.t0=e.catch(0),Error(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=Object(s.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat("/api/login","/logout"));case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),$={login:Q,currentUser:function(){var e=Object(s.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat("/api/login","/currentUser"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),logout:X},ee=n(474),te=n(477),ne=n(476),ae=n(73),re={logout:function(){return function(){var e=Object(s.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.logout();case 2:P.ejectInterceptor(),t({type:"LOGOUT_USER"});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}},ce=Object(m.b)(function(e){return{user:e.user}},re)(function(e){var t=!!e.user&&!!e.user.username,n="LOGGED_IN"===e.user.loginStatus?"/home":"/";return c.a.createElement("div",null,c.a.createElement(ne.a,{bg:"light",expand:"lg"},c.a.createElement(ae.LinkContainer,{exact:!0,to:n},c.a.createElement(ne.a.Brand,null,"Fitness App")),c.a.createElement(ne.a.Toggle,{"aria-controls":"basic-navbar-nav"}),c.a.createElement(ne.a.Collapse,{id:"basic-navbar-nav"},t?c.a.createElement(ee.a,{className:"mr-auto"},c.a.createElement(ae.LinkContainer,{exact:!0,to:"/home"},c.a.createElement(ee.a.Link,{eventKey:"/home"},"Home")),c.a.createElement(ee.a.Link,{onClick:function(){return e.logout()}},"Logout"),c.a.createElement(te.a,{title:"Dropdown",id:"basic-nav-dropdown"},c.a.createElement(te.a.Item,{href:"#action/3.1"},"Action"),c.a.createElement(te.a.Item,{href:"#action/3.2"},"Another action"),c.a.createElement(te.a.Item,{href:"#action/3.3"},"Something"),c.a.createElement(te.a.Divider,null),c.a.createElement(te.a.Item,{href:"#action/3.4"},"Separated link"))):c.a.createElement(ee.a,{className:"mr-auto"},c.a.createElement(ae.LinkContainer,{exact:!0,to:"/login"},c.a.createElement(ee.a.Link,{eventKey:"/login"},"Login")),c.a.createElement(ae.LinkContainer,{exact:!0,to:"/signup"},c.a.createElement(ee.a.Link,{eventKey:"/signup"},"Sign Up"))))))}),ie=n(43),oe=n(475),ue=n(480),le=n(481),se={login:function(e){return function(){var t=Object(s.a)(l.a.mark(function t(n){var a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,$.login(e);case 3:return a=t.sent,console.log("dispatcing ",a.data),t.abrupt("return",n({type:"SET_USER",data:a.data}));case 8:t.prev=8,t.t0=t.catch(0),console.log("Login failed: ",t.t0.code,t.t0.message);case 11:case"end":return t.stop()}},t,null,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()}},me=Object(p.k)(Object(m.b)(null,se)(function(e){var t=Object(r.useState)(""),n=Object(ie.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)(""),u=Object(ie.a)(o,2),m=u[0],p=u[1],d=function(){var t=Object(s.a)(l.a.mark(function t(){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={username:a,password:m},document.getElementById("loginForm").reset(),t.next=4,e.login(n);case 4:e.history.push("/");case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("h4",null,"Login"),c.a.createElement("form",{id:"loginForm"},c.a.createElement(oe.a,null,c.a.createElement(ue.a,null,"Username"),c.a.createElement(le.a,{id:"username",onChange:function(e){i(e.target.value)},type:"text",name:"username",placeholder:"Enter username"}),c.a.createElement(ue.a,null,"Password"),c.a.createElement(le.a,{onChange:function(e){p(e.target.value)},type:"password",id:"password",name:"password",placeholder:"Enter password"}),c.a.createElement(T.a,{onClick:d},"Login"))))})),pe={addUser:function(e){return function(){var t=Object(s.a)(l.a.mark(function t(n){var a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Z.post(e);case 2:a=t.sent,n({type:"SET_USER",data:a});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}},de=Object(p.k)(Object(m.b)(null,pe)(function(e){var t=Object(r.useState)(""),n=Object(ie.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)(""),u=Object(ie.a)(o,2),m=u[0],p=u[1],d=Object(r.useState)(""),f=Object(ie.a)(d,2),v=f[0],E=f[1],h=Object(r.useState)(""),g=Object(ie.a)(h,2),y=g[0],b=g[1],w=function(){var t=Object(s.a)(l.a.mark(function t(){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={firstName:a,lastName:m,username:v,password:y},document.getElementById("addUserForm").reset(),t.next=4,e.addUser(n);case 4:e.history.push("/");case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("form",{id:"addUserForm"},c.a.createElement("h4",null,"Sign Up"),c.a.createElement(oe.a,null,c.a.createElement(ue.a,null,"First name"),c.a.createElement(le.a,{onChange:function(e){i(e.target.value)},type:"text",name:"firstName",placeholder:"Enter first name"}),c.a.createElement(ue.a,null,"Last name"),c.a.createElement(le.a,{onChange:function(e){p(e.target.value)},type:"text",name:"lastName",placeholder:"Enter last name"}),c.a.createElement(ue.a,null,"Username"),c.a.createElement(le.a,{onChange:function(e){E(e.target.value)},type:"text",name:"username",placeholder:"Enter username"}),c.a.createElement(ue.a,null,"Password"),c.a.createElement(le.a,{onChange:function(e){b(e.target.value)},type:"password",name:"password",placeholder:"Enter password"}),c.a.createElement(T.a,{onClick:w},"Submit"))))})),fe=Object(m.b)(function(e){return{user:e.user}},null)(function(e){return c.a.createElement("div",null,c.a.createElement("h4",null,"Please authorize access to your Strava data"),c.a.createElement("button",{onClick:function(){return function(){var t=Object(s.a)(l.a.mark(function t(n){var a,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),console.log("WTF"),a="".concat(window.location.href,"api/stravaauth/authCode/").concat(e.user.id),r="http://www.strava.com/oauth/authorize?client_id=33120&response_type=code&redirect_uri="+a+"&approval_prompt=force&scope=profile:write,activity:write,activity:read_all",window.location.href=r;case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}},"Authorize"))}),ve=function(){return c.a.createElement("div",null,c.a.createElement("h1",null,"WELCOME PAGE"))},Ee=function(){var e=Object(s.a)(l.a.mark(function e(t){var n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("NOT_CHECKED"!==t.user.loginStatus){e.next=12;break}return e.prev=1,e.next=4,$.currentUser();case 4:n=e.sent,a=n.data,t.setUser(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),e.t0.response&&401===e.t0.response.status?(console.log("Login failed"),t.loginFailed()):console.log(e.t0);case 12:"LOGGED_IN"!==t.user.loginStatus||t.activities.initialized||t.user.stravaToken&&t.user.stravaToken.accessToken&&(P.setInterceptor(t.user),t.initializeActivities());case 13:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t){return e.apply(this,arguments)}}(),he={initializeActivities:function(){return function(){var e=Object(s.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.getAll();case 2:n=e.sent,t({type:"INITIALIZE_ACTIVITIES",data:n});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},setUser:function(e){return function(t){t({type:"SET_USER",data:e})}},loginFailed:function(){return function(e){e({type:"LOGIN_FAILED"})}}},ge=Object(p.k)(Object(m.b)(function(e){return{user:e.user,activities:e.activities}},he)(function(e){Object(r.useEffect)(function(){Ee(e),function(e){var t=e.user.loginStatus,n="NOT_CHECKED"===t||"LOGGED_IN"===t,a=n&&e.user.stravaToken&&!e.user.stravaToken.accessToken,r=e.history.location.pathname,c=["/","/login","/signup","/requestAuthorization"];n&&a&&"/requestAuthorization"!==r?e.history.push("/requestAuthorization"):n&&c.includes(r)?e.history.push("/home"):n||c.includes(r)||e.history.push("/login")}(e)},[e]);return c.a.createElement("div",{className:"container"},c.a.createElement(ce,null),"NOT_CHECKED"===e.user.loginStatus?c.a.createElement("div",null,c.a.createElement("h1",null,"SPINNER...")):c.a.createElement("div",null,c.a.createElement(p.d,{exact:!0,path:"/",component:ve}),c.a.createElement(p.d,{path:"/home",component:W}),c.a.createElement(p.d,{exact:!0,path:"/login",component:me}),c.a.createElement(p.d,{exact:!0,path:"/signup",component:de}),c.a.createElement(p.d,{exact:!0,path:"/requestAuthorization",component:fe})))})),ye=n(67),be=n(58),we=n(210),ke=Object(be.c)({activities:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;return"INITIALIZE_ACTIVITIES"===t.type?{initialized:!0,activityList:t.data}:"LOGOUT_USER"===t.type?J:e},activitiesSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;return"SET_ACTIVITY"===t.type?Object(N.a)({},e,{selectedActivity:t.data}):e},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loginStatus:"NOT_CHECKED"},t=arguments.length>1?arguments[1]:void 0;return"SET_USER"===t.type?Object(N.a)({},t.data,{loginStatus:"LOGGED_IN"}):"LOGOUT_USER"===t.type||"LOGIN_FAILED"===t.type?{loginStatus:"NOT_LOGGED_IN"}:e}}),Se=Object(be.d)(ke,Object(be.a)(we.a));o.a.render(c.a.createElement(m.a,{store:Se},c.a.createElement(ye.BrowserRouter,null,c.a.createElement(ge,null))),document.getElementById("root"))}},[[237,1,2]]]);
//# sourceMappingURL=main.f4aa3bce.chunk.js.map